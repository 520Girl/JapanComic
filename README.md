# 漫画自动阅读工具

这是一个基于AutoJS Pro开发的漫画自动阅读工具，可以帮助您自动翻页和跳转章节，让您享受更轻松的漫画阅读体验。

## 项目架构

项目采用模块化设计，分为几个核心组件：

```
comic/                      # 项目根目录
├── main.js                 # 主程序入口，负责UI界面展示和悬浮窗控制
├── rhino.js                # 核心阅读脚本，使用兼容性更好的rhino引擎运行
├── controller.js           # 漫画阅读控制器，负责核心控制逻辑
├── config.js               # 配置管理模块，负责保存和加载用户设置
├── logger.js               # 日志系统模块，负责记录运行日志和错误信息
├── logs/                   # 日志文件目录
├── project.json            # AutoJS项目配置文件
├── package.json            # Node.js包配置文件 
└── README.md               # 项目说明文档
```

### 模块说明

1. **main.js**：
   - 应用程序入口
   - 使用"ui"模式运行，提供图形界面
   - 负责创建和管理悬浮窗控制面板
   - 处理用户交互和配置管理
   - 通过事件机制与rhino.js通信

2. **rhino.js**：
   - 使用"rhino"模式运行，确保更好的兼容性
   - 包含主要的漫画阅读逻辑和自动化操作
   - 通过事件机制与main.js中的控制器通信
   - 实现滚动、翻页和章节检测等功能

3. **controller.js**：
   - 提供漫画阅读的核心控制逻辑
   - 管理开始、暂停、继续和停止等操作
   - 维护阅读状态和配置
   - 可以单独测试和使用

4. **config.js**：
   - 管理应用程序配置
   - 提供加载、保存、更新和重置配置的功能
   - 维护默认配置和用户自定义配置
   - 支持配置持久化到文件

5. **logger.js**：
   - 提供全面的日志记录功能
   - 支持多级别日志（debug、info、warn、error）
   - 实现日志文件轮换和管理
   - 收集设备和错误信息用于远程调试
   - 支持日志压缩和分享

## 通信机制

项目采用事件广播机制进行跨模块通信：

```
main.js (UI线程) <--[事件广播]--> rhino.js (Rhino引擎)
       |
       v
  controller.js
       |
       v
   config.js
       |
       v
   logger.js
```

* 使用`events.broadcast`进行模块间通信
* 采用请求-响应模式确保可靠性
* 自定义事件名称避免冲突

## 日志系统

项目集成了完善的日志系统，用于记录运行状态和错误信息，方便远程调试和问题排查：

### 日志功能特点

- **多级别日志**：支持debug、info、warn、error四个日志级别
- **文件日志**：自动将日志写入文件，按日期分类
- **日志轮换**：自动管理日志文件大小和数量
- **设备信息收集**：记录设备型号、系统版本等信息
- **错误详情**：捕获并记录详细的错误堆栈信息
- **日志压缩**：支持将日志打包为zip文件分享
- **全局异常捕获**：捕获未处理的异常并记录
- **可配置**：通过config.js中的logging配置项自定义日志行为

### 日志配置选项

```javascript
logging: {
    enabled: true,           // 是否启用日志系统
    logLevel: "info",        // 日志级别: debug, info, warn, error, none
    logToFile: true,         // 是否将日志写入文件
    logToConsole: true,      // 是否在控制台显示日志
    maxFileSize: 1024 * 1024, // 单个日志文件最大大小 (1MB)
    maxFiles: 5,             // 最大保留日志文件数
    logDir: "./logs",        // 日志文件目录
    errorReport: false,      // 是否启用错误上报
    reportUrl: "",           // 错误上报地址
    deviceInfo: true         // 是否收集设备信息
}
```

### 日志使用示例

```javascript
// 创建日志记录器
var logger = require("./logger.js").createLogger("模块名称");

// 记录不同级别的日志
logger.debug("调试信息");
logger.info("一般信息");
logger.warn("警告信息");
logger.error("错误信息", error对象);

// 获取日志压缩包
var logArchive = logger.getLogArchive();
```

## 兼容性考虑

为确保在各种AutoJS环境和Android版本上运行：

* 避免使用ES6+特性（如箭头函数、剩余参数等）
* 提供错误处理和恢复机制
* 使用多种滚动和检测方法，优先尝试最可靠的方法
* 在触发错误时提供友好的用户提示
* 通过rhino引擎运行核心脚本确保最大兼容性

## 功能特点

- **自动滚动**：按照设定的速度自动向下滚动阅读漫画
- **自动翻章**：检测到章节结束时自动跳转到下一章
- **悬浮控制面板**：
  - 暂停/继续：随时控制阅读状态
  - 停止：完全停止阅读任务
  - 设置：调整阅读速度和其他选项
  - 退出：关闭悬浮窗和脚本
- **个性化配置**：
  - 阅读速度调节（从慢速到快速）
  - 自动翻页开关
  - 自动下一章开关
  - 调试模式
- **错误恢复**：内置多重容错机制，提高稳定性
- **配置持久化**：记住您的阅读偏好
- **完善的日志**：支持远程调试和错误诊断

## 使用方法

1. 安装AutoJS Pro应用（需要4.x或更高版本）
2. 导入本项目到AutoJS
3. 启动主脚本`main.js`
4. 输入激活码（目前为测试版本，任何代码都可以）
5. 点击"开始运行"按钮
6. 授予必要的权限（无障碍服务权限、悬浮窗权限等）
7. 打开您想要阅读的漫画APP并进入漫画页面
8. 使用悬浮窗上的控制按钮操作

## 开发与调试

如果您想修改或扩展此项目：

1. **调试模式**：在设置中启用调试模式查看详细日志
2. **模块测试**：每个模块都可以单独测试
   ```javascript
   // 测试控制器
   var controller = require("./controller.js");
   controller.start();
   ```
3. **添加新功能**：
   - 在controller.js中添加新的控制方法
   - 在main.js中添加对应的UI元素
   - 在rhino.js中实现具体操作
4. **兼容性注意事项**：
   - 避免使用ES6+特性
   - 提供多种实现方式以确保兼容性
   - 测试不同Android版本
5. **日志调试**：
   - 查看logs目录下的日志文件
   - 使用`logger.getLogArchive()`获取日志压缩包
   - 调整logLevel为"debug"获取更详细的日志

## 远程调试和错误诊断

当用户遇到问题时，可以通过以下步骤获取日志进行远程诊断：

1. 在设置中启用"调试模式"
2. 重现问题
3. 在设置中点击"导出日志"
4. 将生成的日志压缩包发送给开发者
5. 开发者可以通过日志分析问题原因

如果需要实时错误上报，可以配置errorReport和reportUrl选项，将错误自动上报到指定服务器。

## 已知问题

- 不同漫画APP界面结构不同，可能需要调整检测逻辑
- 有时需要多次尝试才能正确检测章节结束
- 在某些设备上滚动速度可能不够流畅
- 低内存设备可能出现卡顿

## 未来计划

- [ ] 添加多漫画源支持
- [ ] 优化章节检测算法
- [ ] 添加阅读历史记录功能
- [ ] 改进UI设计
- [ ] 增加更多自定义选项
- [ ] 完善错误上报和远程诊断功能

## 贡献

欢迎提交问题和建议，帮助改进这个项目。

## 许可

本项目仅供个人学习和研究使用，请勿用于任何商业用途。使用本工具请遵守相关法律法规和漫画平台的用户协议。 